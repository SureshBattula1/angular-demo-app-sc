<div class="data-table-container">
  <!-- Header Section -->
  <div class="table-header">
    <!-- Row 1: Title and Add Button -->
    <div class="header-row-1">
      <div class="header-left">
        <h2 class="table-title" *ngIf="title">{{ title }}</h2>
      </div>
      
      <div class="header-right">
        <!-- Primary Action Button -->
        <button mat-raised-button 
          color="primary"
          class="primary-action-btn"
          *ngIf="config.showAddButton !== false"
          (click)="onAdd()">
          <mat-icon>add</mat-icon>
           {{ (title || 'ITEM').toUpperCase() }}
          <!-- <mat-icon>keyboard_arrow_down</mat-icon> -->
        </button>
        
        <!-- View Toggle (Mobile) -->
        <div class="view-toggle" *ngIf="isMobile && config.responsive">
          <button mat-icon-button 
            [class.active]="viewMode === 'list'"
            (click)="viewMode = 'list'"
            matTooltip="List View">
            <mat-icon>list</mat-icon>
          </button>
          <button mat-icon-button 
            [class.active]="viewMode === 'card'"
            (click)="viewMode = 'card'"
            matTooltip="Card View">
            <mat-icon>grid_view</mat-icon>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Row 2: Search on Left, Filters on Right -->
    <div class="header-row-2" *ngIf="config.filterable || config.searchable || config.exportable">
      <!-- Left Side: Search Section -->
      <div class="search-section" *ngIf="config.searchable">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search in table...</mat-label>
          <input matInput 
            #searchInput
            placeholder="Search in table..." 
            [(ngModel)]="searchQuery"
            (keyup)="applySearch($event)">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>
        
      </div>
      
      <!-- Right Side: Filter Info and Export -->
      <div class="filter-actions-block">
        <div class="filter-info" *ngIf="config.filterable">
          <button mat-stroked-button class="add-filter-btn" (click)="openAdvancedSearch()">
            <mat-icon>add</mat-icon>
            ADD FILTER
          </button>
          <span class="member-count" *ngIf="data.length > 0">
            {{ data.length }} (100%) of {{ data.length }} {{ title.toLowerCase() || 'items' }}
          </span>
        </div>
        

        <!-- Advanced Search Button -->
        <button mat-icon-button 
          *ngIf="advancedSearchConfig"
          class="advanced-search-btn"
          matTooltip="Advanced Search"
          (click)="openAdvancedSearch()">
          <mat-icon>tune</mat-icon>
        </button>
        
        <!-- Reset Button -->
        <button mat-icon-button 
          class="reset-btn"
          matTooltip="Clear All Filters"
          (click)="resetAllFilters()"
          [disabled]="!hasActiveFilters()">
          <mat-icon>refresh</mat-icon>
        </button>
        <!-- Export Button -->
        <button mat-icon-button 
          *ngIf="config.exportable"
          class="export-btn-icon"
          matTooltip="Export Data"
          (click)="onExport('csv')">
          <mat-icon>download</mat-icon>
        </button>
      </div>
    </div>
  </div>
  
 
  
  <!-- No Data Message -->
  <div class="no-data-container" *ngIf="!loading && dataSource && dataSource.data && dataSource.data.length === 0 && viewMode === 'list'">
    <div class="no-data-content">
      <mat-icon class="no-data-icon">inbox</mat-icon>
      <h3>No Data Found</h3>
      <p *ngIf="searchQuery || hasActiveFilters()">
        No results match your search criteria. Try adjusting your filters.
      </p>
      <p *ngIf="!searchQuery && !hasActiveFilters()">
        No {{ title.toLowerCase() || 'records' }} available yet.
      </p>
      <button mat-raised-button color="primary" *ngIf="config.showAddButton !== false" (click)="onAdd()">
        <mat-icon>add</mat-icon>
        Add {{ title || 'Item' }}
      </button>
    </div>
  </div>

  <!-- Table View (Desktop/Tablet) -->
  <div class="table-wrapper" *ngIf="viewMode === 'list' && dataSource && dataSource.data && dataSource.data.length > 0">
    <table mat-table [dataSource]="dataSource" matSort class="data-table">
      
      <!-- Selection Column -->
      <ng-container matColumnDef="select" *ngIf="config.selectable">
        <th mat-header-cell *matHeaderCellDef class="checkbox-column">
          <mat-checkbox
            (change)="$event ? toggleAllRows() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="isIndeterminate()">
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row" class="checkbox-column">
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="$event ? toggleRow(row) : null"
            [checked]="isSelected(row)">
          </mat-checkbox>
        </td>
      </ng-container>
      
      <!-- Dynamic Columns -->
      <ng-container *ngFor="let column of config.columns" [matColumnDef]="column.key">
        <th mat-header-cell 
          *matHeaderCellDef 
          [mat-sort-header]="column.sortable ? column.key : ''"
          [style.width]="column.width"
          [style.text-align]="column.align || 'left'">
          <div class="header-content">
            {{ column.header }}
          </div>
        </th>
        <td mat-cell 
          *matCellDef="let row" 
          [style.text-align]="column.align || 'left'"
          [ngClass]="getCellClass(row, column)">
          
          <!-- Custom Template -->
          <ng-container *ngIf="column.customTemplate">
            <ng-container *ngTemplateOutlet="column.customTemplate; context: {$implicit: row}">
            </ng-container>
          </ng-container>
          
          <!-- Default Rendering -->
          <ng-container *ngIf="!column.customTemplate">
            <span *ngIf="column.type === 'text' || !column.type">
              {{ getCellValue(row, column) }}
            </span>
            
            <span *ngIf="column.type === 'badge'" class="badge">
              {{ getCellValue(row, column) }}
            </span>
            
            <img *ngIf="column.type === 'avatar'" 
              [src]="getCellValue(row, column)" 
              class="avatar"
              [alt]="row.name || 'Avatar'">
          </ng-container>
        </td>
      </ng-container>
      
      <!-- Actions Column -->
      <ng-container matColumnDef="actions" *ngIf="config.actions">
        <th mat-header-cell *matHeaderCellDef class="actions-column">Actions</th>
        <td mat-cell *matCellDef="let row" class="actions-column">
          <div class="action-buttons">
            <button mat-icon-button 
              *ngFor="let action of config.actions"
              [matTooltip]="action.label"
              [color]="action.color"
              (click)="onActionClick(action, row); $event.stopPropagation()"
              [hidden]="action.show && !action.show(row)">
              <mat-icon>{{ action.icon }}</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>
      
      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row 
        *matRowDef="let row; columns: displayedColumns;"
        (click)="onRowClick(row)"
        class="table-row">
      </tr>
    </table>
  </div>
  
  <!-- Card View (Mobile) -->
  <div class="card-view" *ngIf="viewMode === 'card'">
    <!-- No Data Message for Card View -->
    <div class="no-data-container" *ngIf="!loading && dataSource && dataSource.data && dataSource.data.length === 0">
      <div class="no-data-content">
        <mat-icon class="no-data-icon">inbox</mat-icon>
        <h3>No Data Found</h3>
        <p *ngIf="searchQuery || hasActiveFilters()">
          No results match your search criteria. Try adjusting your filters.
        </p>
        <p *ngIf="!searchQuery && !hasActiveFilters()">
          No {{ title.toLowerCase() || 'records' }} available yet.
        </p>
        <button mat-raised-button color="primary" *ngIf="config.showAddButton !== false" (click)="onAdd()">
          <mat-icon>add</mat-icon>
          Add {{ title || 'Item' }}
        </button>
      </div>
    </div>

    <!-- Cards -->
    <mat-card *ngFor="let row of dataSource && dataSource.data ? dataSource.data : []" class="data-card" (click)="onRowClick(row)">
      <mat-card-content>
        <div class="card-field" *ngFor="let column of config.columns">
          <span class="field-label">{{ column.header }}:</span>
          <span class="field-value">{{ getCellValue(row, column) }}</span>
        </div>
      </mat-card-content>
      <mat-card-actions *ngIf="config.actions">
        <button mat-button 
          *ngFor="let action of config.actions"
          (click)="onActionClick(action, row); $event.stopPropagation()">
          <mat-icon>{{ action.icon }}</mat-icon>
          {{ action.label }}
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
  
  <!-- Pagination (hidden when no data) -->
  <mat-paginator 
    *ngIf="config.pagination !== false && dataSource && dataSource.data && dataSource.data.length > 0"
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    [length]="config.serverSide ? totalCount : (dataSource.data ? dataSource.data.length : 0)"
    [pageIndex]="currentPage"
    [disabled]="loading"
    showFirstLastButtons>
  </mat-paginator>
  
  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="loading">
    <mat-spinner></mat-spinner>
  </div>
  
  <!-- Advanced Search Sidebar -->
  <app-advanced-search-sidebar
    *ngIf="advancedSearchConfig"
    [isOpen]="showAdvancedSearch"
    [config]="advancedSearchConfig"
    [savedSearches]="savedSearches"
    (searchApplied)="onAdvancedSearchApplied($event)"
    (searchReset)="onSearchReset()"
    (searchSaved)="onSearchSaved($event)"
    (closed)="closeAdvancedSearch()">
  </app-advanced-search-sidebar>
</div>

